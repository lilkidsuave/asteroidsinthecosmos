cosmos-installer: null
version: "3.9"
services:
  "{ServiceName}-firefly-iii":
    image: fireflyiii/core:version-6
    container_name: "{ServiceName}-firefly-iii"
    restart: unless-stopped
    volumes:
      - ${APP_DATA_DIR}/data/uplodad:/var/www/html/storage/upload
    ports:
      - ${APP_PORT}:8080
    depends_on:
      - firefly-iii-db
    environment:
      - APP_ENV=local
      - APP_DEBUG=false
      - SITE_OWNER=${EMAIL}
      - APP_KEY=${APP_KEY}
      - STATIC_CRON_TOKEN=${STATIC_CRON_TOKEN}
      - TZ=${TZ}
      - TRUSTED_PROXIES=**
      - DB_CONNECTION=mysql
      - DB_HOST=firefly-iii-db
      - DB_PORT=3306
      - DB_DATABASE=firefly
      - DB_USERNAME=firefly
      - DB_PASSWORD=${MYSQL_PASSWORD}
      - COOKIE_PATH="/"
      - COOKIE_DOMAIN=
      - COOKIE_SECURE=false
      - COOKIE_SAMESITE=lax
      - APP_NAME=FireflyIII
      - BROADCAST_DRIVER=log
      - QUEUE_DRIVER=sync
      - CACHE_PREFIX=firefly
      - IS_HEROKU=false
      - FIREFLY_III_LAYOUT=v1
      - APP_URL=http://localhost:${APP_PORT}
    networks:
      - tipi_main_network
    hostname: "{ServiceName}-firefly-iii"
  "{ServiceName}-firefly-iii-db":
    container_name: "{ServiceName}-firefly-iii-db"
    image: mariadb
    hostname: "{ServiceName}-firefly-iii-db"
    restart: unless-stopped
    environment:
      - MYSQL_RANDOM_ROOT_PASSWORD=yes
      - MYSQL_USER=firefly
      - MYSQL_PASSWORD=${MYSQL_PASSWORD}
      - MYSQL_DATABASE=firefly
    volumes:
      - ${APP_DATA_DIR}/data/db:/var/lib/mysql
    networks:
      - tipi_main_network
  "{ServiceName}-firefly-iii-cron":
    container_name: "{ServiceName}-firefly-iii-cron"
    image: alpine
    command: sh -c "echo \"0 3 * * * wget -qO-
      http://${APP_DOMAIN}/api/v1/cron/${STATIC_CRON_TOKEN}\" | crontab - &&
      crond -f -L /dev/stdout"
    networks:
      - tipi_main_network
    hostname: "{ServiceName}-firefly-iii-cron"
minVersion: 0.14.0-0
